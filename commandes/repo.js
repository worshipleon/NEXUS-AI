"use strict";
const { zokou } = require("../framework/zokou");
const axios = require("axios");

zokou({ 
  nomCom: "repo", 
  categorie: "General",
  reaction: "ğŸ”",
  aliases: ["source", "script"],
  desc: "Show bot repository information",
  nomFichier: __filename 
}, async (dest, zk, commandeOptions) => {
  const { repondre } = commandeOptions;
  const githubRepo = 'https://api.github.com/repos/pkdriller/QUEEN-M';
  const thumbnailImg = 'https://files.catbox.moe/4i9gd4.jpg';

  try {
    // Fetch repository data
    const response = await axios.get(githubRepo, { timeout: 10000 });
    const data = response.data;

    if (!data) {
      return repondre("Could not fetch data");
    }

    const repoInfo = {
      stars: data.stargazers_count,
      forks: data.forks_count,
      lastUpdate: new Date(data.updated_at).toLocaleDateString('en-GB'),
      owner: data.owner.login,
    };

    const releaseDate = new Date(data.created_at).toLocaleDateString('en-GB');

    // Maintained exact cage formatting as requested
    const gitdata = `*Hey Pal? You love the bot Right?*\n  
      *Here is all you need to Know*
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚â”‚ *ğ‘ğğ©ğ¨:* ${data.html_url}
â”‚â”‚ *ğ’ğ­ğšğ«ğ¬:* ${repoInfo.stars}
â”‚â”‚ *ğ…ğ¨ğ«ğ¤ğ¬:* ${repoInfo.forks}
â”‚â”‚ *ğ‘ğğ¥ğğšğ¬ğ ğƒğšğ­ğ:* ${releaseDate}
â”‚â”‚ *ğ”ğ©ğğšğ­ğğ: ${repoInfo.lastUpdate}
â”‚â”‚ *ğ‚ğ¡ğšğ§ğ§ğğ¥:* https://whatsapp.com/channel/0029Vad7YNyJuyA77CtIPX0x
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`;

    await zk.sendMessage(dest, { 
      image: { url: thumbnailImg }, 
      caption: gitdata,
      contextInfo: {
        externalAdReply: {
          title: "Bot Repository",
          body: "Fork and star the repo!",
          thumbnailUrl: thumbnailImg,
          mediaType: 1,
          sourceUrl: data.html_url,
          renderLargerThumbnail: true
        }
      }
    });

  } catch (error) {
    console.log("Error fetching data:", error);
    repondre("An error occurred while fetching repository data.");
  }
});
